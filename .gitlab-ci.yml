stages:
  - test
  - build

test:
  interruptible: true
  stage: test
  image: node:17
  only:
    - merge_requests
    - main
  before_script:
    - apt-get update
    - apt-get install -y xvfb
    - apt-get install -y zip
    - apt-get install -y wget
    - apt-get install -y ca-certificates
    - apt-get install -y libnss3-dev libasound2 libxss1 libappindicator3-1 gconf-service libgconf-2-4 libpango1.0-0 xdg-utils fonts-liberation libgbm1
    - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb 
    - dpkg -i google-chrome*.deb 
    - rm google-chrome*.deb
    - wget -N http://chromedriver.storage.googleapis.com/89.0.4389.23/chromedriver_linux64.zip
    - unzip chromedriver_linux64.zip
    - chmod +x chromedriver
    - cp chromedriver /usr/local/bin
    - rm chromedriver_linux64.zip
    - rm chromedriver
    - npm install
  script:
    - npm run test

build:
  image: node:17
  stage: build
  only:
    - merge_requests
    - main
  script:
    - npm install
    - npm run build
  artifacts:
    expire_in: 1 day
    paths:
      - dist/